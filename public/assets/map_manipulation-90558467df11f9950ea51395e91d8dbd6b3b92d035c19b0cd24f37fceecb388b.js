if(0<$(".gates").val().length)var gates=JSON.parse($(".gates").val());if(0<$(".beacons").val().length)var beacons=JSON.parse($(".beacons").val());if(0<$(".corridors").val().length)var corridors=JSON.parse($(".corridors").val());!function(){function e(){function i(e){f.location_id=e,console.log("currentMarker",f),p=!1,$("#beaconsModal").modal("hide")}function l(){$("#beaconsModal").modal("hide")}var e={zoom:13,center:loc_center},t=new google.maps.Map(document.getElementById("map-canvas"),e),o=new google.maps.LatLng(loc_center.lat()-k_diff,loc_center.lng()-D_diff),n=new google.maps.LatLng(loc_center.lat()+k_diff,loc_center.lng()+D_diff),a=new google.maps.LatLngBounds(o,n),s=$("#map-canvas").attr("data-image");overlay=new v(a,s,t);var g=new google.maps.Marker({position:loc_center,icon:"/move.svg",map:t,draggable:!0});google.maps.event.addListener(g,"drag",function(){var e=new google.maps.LatLng(g.getPosition().lat()-k_diff,g.getPosition().lng()-D_diff),o=new google.maps.LatLng(g.getPosition().lat()+k_diff,g.getPosition().lng()+D_diff),t=new google.maps.LatLngBounds(e,o),n=new google.maps.LatLng(g.getPosition().lat()+.005*Math.cos(rot*Math.PI/180),g.getPosition().lng()+.005*Math.sin(rot*Math.PI/180));r.setPosition(o),d.setPosition(n),overlay.updateBounds(t)}),google.maps.event.addListener(g,"dragend",function(){var e=new google.maps.LatLng(g.getPosition().lat()-k_diff,g.getPosition().lng()-D_diff),o=new google.maps.LatLng(g.getPosition().lat()+k_diff,g.getPosition().lng()+D_diff);console.log("point1"+e),console.log("point2"+o)});var r=new google.maps.Marker({position:new google.maps.LatLng(loc_center.lat()+k_diff,loc_center.lng()+D_diff),map:t,draggable:!0,icon:"/resize.svg"});google.maps.event.addListener(r,"drag",function(){k_diff=r.getPosition().lat()-g.getPosition().lat(),D_diff=r.getPosition().lng()-g.getPosition().lng();var e=new google.maps.LatLng(g.getPosition().lat()-k_diff,g.getPosition().lng()-D_diff),o=new google.maps.LatLng(g.getPosition().lat()+k_diff,g.getPosition().lng()+D_diff),t=new google.maps.LatLngBounds(e,o);console.log("newBounds",t),overlay.updateBounds(t)}),google.maps.event.addListener(r,"dragend",function(){var e=new google.maps.LatLng(g.getPosition().lat()-k_diff,g.getPosition().lng()-D_diff),o=new google.maps.LatLng(g.getPosition().lat()+k_diff,g.getPosition().lng()+D_diff);console.log("point1"+e),console.log("point2"+o)});var d=new google.maps.Marker({position:new google.maps.LatLng(loc_center.lat()+k_diff,loc_center.lng()),map:t,draggable:!0,icon:"/rotate.svg"});google.maps.event.addListener(d,"drag",function(){k_rotation_diff=d.getPosition().lat()-g.getPosition().lat(),D_rotation_diff=d.getPosition().lng()-g.getPosition().lng(),rot=180*Math.atan2(D_rotation_diff,k_rotation_diff)/Math.PI,overlay.updateRotation()});var c=new google.maps.drawing.DrawingManager({drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[]},polygonOptions:{fillColor:"#ffff00",fillOpacity:.6,strokeWeight:1,clickable:!1,editable:!0,zIndex:1},markerOptions:{draggable:!0}});c.setMap(t),google.maps.event.addListener(c,"overlaycomplete",function(e){all_overlays.push(e.overlay);var t=e.overlay;t.type=e.type,e.type!==google.maps.drawing.OverlayType.MARKER?(c.setDrawingMode(null),google.maps.event.addListener(t,"click",function(e){if(e.vertex!==undefined){var o;if(t.type===google.maps.drawing.OverlayType.POLYGON)(o=t.getPaths().getAt(e.path)).removeAt(e.vertex),o.length<3&&t.setMap(null);if(t.type===google.maps.drawing.OverlayType.POLYLINE)(o=t.getPath()).removeAt(e.vertex),o.length<2&&t.setMap(null)}setSelection(t)})):google.maps.event.addListener(t,"click",function(){setSelection(t)}),setSelection(t)}),beacons.forEach(function(e){var o={lat:e.latitude,lng:e.longitude};e=new google.maps.Marker({position:o,map:t,label:"B"})}),gates.forEach(function(e){var o={lat:e.latitude,lng:e.longitude};e=new google.maps.Marker({position:o,map:t,label:"G"})});var p,f,m=[];corridors.forEach(function(e){m.push({lat:e.latitude,lng:e.longitude})}),new google.maps.Polygon({paths:m,fillColor:"#ffff00",fillOpacity:.6,strokeWeight:1,clickable:!1,editable:!0,zIndex:1}).setMap(t),google.maps.event.addListener(c,"drawingmode_changed",clearSelection),google.maps.event.addListener(t,"click",clearSelection),google.maps.event.addDomListener(document.getElementById("deleteButton"),"click",deleteSelectedShape),google.maps.event.addDomListener(document.getElementById("deleteAllButton"),"click",deleteAllShape),$("#custom-BtnPolygon").click(function(){c.setDrawingMode(google.maps.drawing.OverlayType.POLYGON)}),$("#custom-BtnHand").click(function(){c.setDrawingMode(null)}),$("#custom-BtnGate").click(function(){c.setOptions({markerOptions:{label:"G"}}),c.setDrawingMode(google.maps.drawing.OverlayType.MARKER)}),$("#custom-BtnBicons").click(function(){c.setOptions({markerOptions:{label:"B"}}),c.setDrawingMode(google.maps.drawing.OverlayType.MARKER)}),$("#custom-BtnImg").click(function(){g.setDraggable(!1),d.setDraggable(!1),r.setDraggable(!1),$("#bgopacity").val("100"),$("#bgopacity").prop("disabled",!0),$("#theImg").css({opacity:".01"*$("#bgopacity").val()})}),google.maps.event.addListener(c,"markercomplete",function(e){lat=e.getPosition().lat(),lng=e.getPosition().lng(),"B"===(f=e).getLabel()&&$("#beaconsModal").modal(),p=!0}),$("#beaconsModal").on("hidden.bs.modal",function(){console.log("removeMarker_flag",p),p&&(setSelection(f),deleteSelectedShape()),p=!0}),$("body").on("click","#submitButton",function(){var e=$("input[name=major]").val(),o=$("input[name=minor]").val(),t=$("select[name=brand_id]").val(),n=(window.location.origin,window.location.pathname.split("/")[3]),a=window.location.origin+"/admin/buildings/"+n+"/building_levels/get_beacon?major="+e+"&minor="+o+"&brand_id="+t;$(".beaconsModal-loading").show(),$(".beaconsModal-content").hide(),$.ajax({type:"GET",url:a,dataType:"json",success:function(e){i(e.beacon.brand_id),$(".beaconsModal-loading").hide(),$(".alert").hide(),$(".beaconsModal-message").append('<div class="alert alert-success" role="alert"> beacon has been added successfully</div>'),$(".beaconsModal-content").show()},error:function(e){console.log("error",e.responseText),$(".beaconsModal-loading").hide(),$(".alert").hide(),$(".beaconsModal-message").append('<div class="alert alert-danger" role="alert">No beacon with this major/minor</div>'),$(".beaconsModal-content").show(),l()}})})}function v(e,o,t){this.bounds_=e,this.image_=o,this.map_=t,this.div_=null,this.setMap(t)}v.prototype=new google.maps.OverlayView,v.prototype.onAdd=function(){var e=document.createElement("div");e.style.borderStyle="none",e.style.borderWidth="0px",e.style.position="absolute";var o=document.createElement("img");o.src=this.image_,o.style.width="100%",o.style.height="100%",o.style.opacity="0.9",o.style.position="absolute",o.style.transform="rotate(0deg)",o.setAttribute("id","theImg"),e.appendChild(o),this.div_=e,this.getPanes().overlayLayer.appendChild(e)},v.prototype.draw=function(){var e=this.getProjection(),o=e.fromLatLngToDivPixel(this.bounds_.getSouthWest()),t=e.fromLatLngToDivPixel(this.bounds_.getNorthEast()),n=this.div_,a={};if(0<$(".imagePosition").val().length)a=JSON.parse($(".imagePosition").val());console.log("currentPositionData",a.width),console.log("$('.imagePosition').val().length > 0"),console.log(Boolean(0<$(".imagePosition").val().length)),0<$(".imagePosition").val().length?(n.style.width=a.width+"px",n.style.height=a.height+"px",n.style.left=a.left+"px",n.style.top=a.top+"px"):(n.style.width=t.x-o.x+"px",n.style.height=o.y-t.y+"px",n.style.left=o.x+"px",n.style.top=t.y+"px"),n.style.transform="rotate("+rot+"deg)";var i=t.x-o.x,l=o.y-t.y,s=o.x,g=t.y;console.log("width"),console.log(t.x-o.x+"px"),console.log("height"),console.log(o.y-t.y+"px");var r={width:i,height:l,left:s,top:g};$(".imagePosition").val(JSON.stringify(r)),console.log("rotate"),console.log("rotate("+rot+"deg)"),$(".rotation").val(rot)},v.prototype.updateBounds=function(e){this.bounds_=e,this.draw()},v.prototype.updateRotation=function(){this.draw()},v.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},e()}();